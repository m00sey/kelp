{% set event = event if event is defined else selected_event %}
{% if event %}
<div class="event-detail">
    <div class="event-meta">
        <span class="badge type-{{ event.type }}">{{ event.type_label }}</span>
        {% if event.cesr_version %}
        <span class="badge version-badge version-{{ event.cesr_major_version }}">CESR {{ event.cesr_version }}</span>
        {% endif %}
        <span class="meta-item"><strong>Sequence number:</strong> {{ event.sequence_hex }} ({{ event.sequence }})</span>
        <button class="copy-raw-btn" onclick="copyRawCesr(this)" data-raw="{{ event.raw_cesr | e }}">Copy Raw</button>
    </div>
    <div class="identifier-row">
        <strong>Identifier:</strong>
        <code class="full-value">{{ event.identifier }}</code>
    </div>

    <div class="json-section">
        <h3>Event Data</h3>
        <pre class="json-content">{{ event.data | tojson_pretty }}</pre>
    </div>

    {% if event.attachments %}
    <div class="attachments-section">
        <h3>Attachments ({{ event.attachments|length }})</h3>
        {% for attachment in event.attachments %}
        <div class="attachment-item">
            <div class="attachment-header">
                <span class="attachment-type">{{ attachment.name }}</span>
                <span class="attachment-code">[{{ attachment.code }}]</span>
                {% if attachment.count > 0 %}
                    {% if attachment.code in ['-V', '-0V', '-W', '-0W', '-Z', '-0Z', '-L', '-0L'] %}
                <span class="attachment-count">{{ attachment.count * 4 }} bytes</span>
                    {% else %}
                <span class="attachment-count">{{ attachment.count }} sig{% if attachment.count != 1 %}s{% endif %}</span>
                    {% endif %}
                {% endif %}
            </div>

            {% if attachment.materials %}
            <div class="attachment-materials">
                {% for mat in attachment.materials %}
                <div class="material-item">
                    {% if mat.type == 'indexed_sig' %}
                    <span class="material-label">Sig #{{ mat.index }}</span>
                    <code class="full-value">{{ mat.qb64 }}</code>
                    {% elif mat.type == 'witness_sig' %}
                    <span class="material-label">Witness #{{ mat.index }}</span>
                    <code class="full-value">{{ mat.qb64 }}</code>
                    {% elif mat.type == 'receipt_couple' %}
                    <span class="material-label">Prefix</span>
                    <code class="full-value">{{ mat.prefix }}</code>
                    {% elif mat.type == 'seal_source' %}
                    <span class="material-label">Seal sn={{ mat.sn }}</span>
                    <code class="full-value">{{ mat.said }}</code>
                    {% elif mat.type == 'first_seen' %}
                    <span class="material-label">First Seen sn={{ mat.sn }}</span>
                    <code class="full-value">{{ mat.datetime }}</code>
                    {% elif mat.type == 'matter' %}
                    <span class="material-label">{{ mat.code }}</span>
                    <code class="full-value">{{ mat.qb64 }}</code>
                    {% else %}
                    <code class="full-value">{{ mat }}</code>
                    {% endif %}
                </div>
                {% endfor %}
            </div>
            {% else %}
            <code class="full-value attachment-raw">{{ attachment.raw }}</code>
            {% endif %}
        </div>
        {% endfor %}
    </div>
    {% endif %}
</div>
{% else %}
<p class="no-selection">Select an event to view details</p>
{% endif %}
