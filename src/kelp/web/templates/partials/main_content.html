{% if message %}
<div class="message">{{ message }}</div>
{% endif %}

{% if events %}
<div class="filter-bar">
    <span>Filter:</span>
    <button hx-get="/events?filter_type=all" hx-target="#event-list" class="{% if not filter_type or filter_type == 'all' %}active{% endif %}">All</button>
    <button hx-get="/events?filter_type=icp" hx-target="#event-list" class="{% if filter_type == 'icp' %}active{% endif %}">icp</button>
    <button hx-get="/events?filter_type=rot" hx-target="#event-list" class="{% if filter_type == 'rot' %}active{% endif %}">rot</button>
    <button hx-get="/events?filter_type=ixn" hx-target="#event-list" class="{% if filter_type == 'ixn' %}active{% endif %}">ixn</button>
    <button hx-get="/events?filter_type=dip" hx-target="#event-list" class="{% if filter_type == 'dip' %}active{% endif %}">dip</button>
    <button hx-get="/events?filter_type=drt" hx-target="#event-list" class="{% if filter_type == 'drt' %}active{% endif %}">drt</button>
    <span class="filter-separator"></span>
    <input type="text"
           class="jq-filter"
           name="jq_filter"
           placeholder="jq filter: select(.s > 5)"
           value="{{ jq_filter|default('', true) }}"
           hx-get="/events"
           hx-target="#event-list"
           hx-trigger="keyup changed delay:300ms, search"
           hx-include="[name='jq_filter']">
    <div class="jq-editor-container">
        <button type="button" class="jq-editor-toggle" onclick="toggleJqEditor()">?</button>
        <div class="jq-editor-popover" id="jq-editor-popover">
            <div class="jq-editor-content">
                <div class="jq-editor-input-section">
                    <label class="jq-editor-label">jq Filter</label>
                    <textarea class="jq-editor-textarea"
                              id="jq-editor-textarea"
                              placeholder="select(.s > 5)"
                              rows="4"></textarea>
                    <div class="jq-editor-actions">
                        <button type="button" class="jq-editor-apply" onclick="applyJqFilter()">Apply Filter</button>
                        <button type="button" class="jq-editor-clear" onclick="clearJqFilter()">Clear</button>
                    </div>
                </div>
                <div class="jq-editor-guide">
                    <div class="jq-help-title">jq Syntax Guide</div>
                    <div class="jq-help-section">
                        <div class="jq-help-label">Comparisons</div>
                        <code>select(.s > 5)</code> sequence &gt; 5<br>
                        <code>select(.s == 0)</code> inception events<br>
                        <code>select(.t == "ixn")</code> interactions only
                    </div>
                    <div class="jq-help-section">
                        <div class="jq-help-label">String matching</div>
                        <code>select(.i | startswith("E"))</code><br>
                        <code>select(.i | contains("abc"))</code>
                    </div>
                    <div class="jq-help-section">
                        <div class="jq-help-label">Arrays</div>
                        <code>select(.k | length > 1)</code> multi-sig<br>
                        <code>select(.b | length > 0)</code> has witnesses<br>
                        <code>select(any(.a[]?; .i | contains("EJ4H")))</code> anchor AID
                    </div>
                    <div class="jq-help-section">
                        <div class="jq-help-label">Combine conditions</div>
                        <code>select(.s > 0 and .t == "rot")</code>
                    </div>
                    <div class="jq-help-section">
                        <div class="jq-help-label">Common fields</div>
                        <code>.i</code> identifier (AID)<br>
                        <code>.s</code> sequence (use decimal, not hex)<br>
                        <code>.t</code> event type<br>
                        <code>.k</code> keys array<br>
                        <code>.b</code> witnesses array<br>
                        <code>.di</code> delegator (if delegated)
                    </div>
                </div>
            </div>
        </div>
    </div>
    {% if is_witness %}
    <span class="filter-separator"></span>
    <button hx-post="/toggle-all-aids" hx-target="#main-content" hx-swap="innerHTML" class="toggle-aids {% if show_all_aids %}active{% endif %}">
        {% if show_all_aids %}Showing All AIDs{% else %}Show All AIDs{% endif %}
    </button>
    {% endif %}
</div>

<div class="content-grid">
    <div class="event-list-container">
        <div class="panel-header">Events ({{ events|length }})</div>
        <div id="event-list">
            {% include "partials/event_list.html" %}
        </div>
    </div>

    <div class="event-detail-container">
        <div class="panel-header">Event Detail</div>
        <div id="event-detail">
            {% if selected_event %}
                {% include "partials/event_detail.html" with context %}
            {% else %}
                <p class="no-selection">Select an event to view details</p>
            {% endif %}
        </div>
    </div>
</div>
{% else %}
<div class="empty-state">
    <img src="/static/kelp-forest.svg" alt="" class="empty-state-bg">
</div>
{% endif %}
